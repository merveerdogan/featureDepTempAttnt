axis.text.x = element_text(angle = 90, hjust = 1)
) +
labs(
title = "Binned Average Key–Size (50ms bins)",
x = "SizeTime – ColorTime (binned)",
y = "Mean(KeyTime – SizeTime)"
)
p_color_binned <- binned_color %>%
ggplot(aes(x = bin, y = mean_rel, group = 1)) +
geom_line(color = "darkred", size = 1) +
geom_point(color = "darkred", size = 2) +
coord_cartesian(clip = "off") +
facet_wrap(~tempo_pair, ncol = 2) +
theme_bw() +
theme(
axis.text.x = element_text(angle = 90, hjust = 1)
) +
labs(
title = "Binned Average Key–Color (50ms bins)",
x = "SizeTime – ColorTime (binned)",
y = "Mean(KeyTime – ColorTime)"
)
(p_size_binned | p_color_binned)
bin50 <- function(x){
cut(x,
breaks = seq(floor(min(x)), ceiling(max(x)) + 100, by = 100),
include.lowest = TRUE,
right = FALSE)
}
binned_size <- rel_key_size_vs_sc %>%
mutate(
bin = bin50(size_color_delta)
) %>%
group_by(tempo_pair, bin) %>%
summarise(
mean_rel = mean(key_minus_size, na.rm = TRUE),
n = n(),
.groups = "drop"
) %>%
filter(!is.na(bin))
binned_color <- rel_key_color_vs_sc %>%
mutate(
bin = bin50(size_color_delta)
) %>%
group_by(tempo_pair, bin) %>%
summarise(
mean_rel = mean(key_minus_color, na.rm = TRUE),
n = n(),
.groups = "drop"
) %>%
filter(!is.na(bin))
p_size_binned <- binned_size %>%
ggplot(aes(x = bin, y = mean_rel, group = 1)) +
geom_line(color = "steelblue", size = 1) +
geom_point(color = "steelblue", size = 2) +
coord_cartesian(clip = "off") +
facet_wrap(~tempo_pair, ncol = 2) +
theme_bw() +
theme(
axis.text.x = element_text(angle = 90, hjust = 1)
) +
labs(
title = "Binned Average Key–Size (50ms bins)",
x = "SizeTime – ColorTime (binned)",
y = "Mean(KeyTime – SizeTime)"
)
p_color_binned <- binned_color %>%
ggplot(aes(x = bin, y = mean_rel, group = 1)) +
geom_line(color = "darkred", size = 1) +
geom_point(color = "darkred", size = 2) +
coord_cartesian(clip = "off") +
facet_wrap(~tempo_pair, ncol = 2) +
theme_bw() +
theme(
axis.text.x = element_text(angle = 90, hjust = 1)
) +
labs(
title = "Binned Average Key–Color (50ms bins)",
x = "SizeTime – ColorTime (binned)",
y = "Mean(KeyTime – ColorTime)"
)
(p_size_binned | p_color_binned)
rel_key_size_vs_sc$tempo_pair
binned_size_trial <- rel_key_size_vs_sc %>%
mutate(
bin = bin50(size_color_delta, width = 50)
) %>%
group_by(trial, bin) %>%
summarise(
mean_rel = mean(key_minus_size, na.rm = TRUE),
n = n(),
.groups = "drop"
) %>%
filter(!is.na(bin))
binned_size_trial <- rel_key_size_vs_sc %>%
mutate(
bin = bin50(size_color_delta)
) %>%
group_by(trial, bin) %>%
summarise(
mean_rel = mean(key_minus_size, na.rm = TRUE),
n = n(),
.groups = "drop"
) %>%
filter(!is.na(bin))
binned_color_trial <- rel_key_color_vs_sc %>%
mutate(
bin = bin50(size_color_delta)
) %>%
group_by(trial, bin) %>%
summarise(
mean_rel = mean(key_minus_color, na.rm = TRUE),
n = n(),
.groups = "drop"
) %>%
filter(!is.na(bin))
p_size_trial <- binned_size_trial %>%
ggplot(aes(x = bin, y = mean_rel, group = 1)) +
geom_line(color = "steelblue", linewidth = 1) +
geom_point(color = "steelblue", size = 2) +
facet_wrap(~trial, ncol = 4) +       # <<< 8 TRIAL PANELS
theme_bw() +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
labs(
title = "Binned Key–Size per Trial (50ms symmetric bins)",
x = "SizeTime – ColorTime (binned around 0)",
y = "Mean(KeyTime – SizeTime)"
)
p_color_trial <- binned_color_trial %>%
ggplot(aes(x = bin, y = mean_rel, group = 1)) +
geom_line(color = "darkred", linewidth = 1) +
geom_point(color = "darkred", size = 2) +
facet_wrap(~trial, ncol = 4) +       # <<< 8 TRIAL PANELS
theme_bw() +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
labs(
title = "Binned Key–Color per Trial (50ms symmetric bins)",
x = "SizeTime – ColorTime (binned around 0)",
y = "Mean(KeyTime – ColorTime)"
)
library(patchwork)
(p_size_trial | p_color_trial)
binned_size_trial <- binned_size_trial %>%
left_join(
rel_key_size_vs_sc %>% select(trial, tempo_pair) %>% distinct(),
by = "trial"
)
binned_color_trial <- binned_color_trial %>%
left_join(
rel_key_color_vs_sc %>% select(trial, tempo_pair) %>% distinct(),
by = "trial"
)
p_size_trial <- binned_size_trial %>%
ggplot(aes(x = bin, y = mean_rel, group = 1)) +
geom_line(color = "steelblue", linewidth = 1) +
geom_point(color = "steelblue", size = 2) +
facet_wrap(~tempo_pair, ncol = 4) +     # <<< titles = tempo pairs
theme_bw() +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
labs(
title = "Binned Key–Size per Tempo Pair (100ms bins)",
x = "SizeTime – ColorTime (binned)",
y = "Mean(KeyTime – SizeTime)"
)
p_color_trial <- binned_color_trial %>%
ggplot(aes(x = bin, y = mean_rel, group = 1)) +
geom_line(color = "darkred", linewidth = 1) +
geom_point(color = "darkred", size = 2) +
facet_wrap(~tempo_pair, ncol = 4) +     # <<< titles = tempo pairs
theme_bw() +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
labs(
title = "Binned Key–Color per Tempo Pair (100ms bins)",
x = "SizeTime – ColorTime (binned)",
y = "Mean(KeyTime – ColorTime)"
)
(p_size_trial | p_color_trial)
binned_color_trial <- rel_key_color_vs_sc %>%
mutate(
bin = bin50(size_color_delta)
) %>%
group_by(trial, bin) %>%
summarise(
mean_rel = mean(key_minus_color, na.rm = TRUE),
n = n(),
.groups = "drop"
) %>%
filter(!is.na(bin))
binned_size_trial <- binned_size_trial %>%
left_join(
rel_key_size_vs_sc %>% select(trial, tempo_pair) %>% distinct(),
by = "trial"
)
binned_color_trial <- binned_color_trial %>%
left_join(
rel_key_color_vs_sc %>% select(trial, tempo_pair) %>% distinct(),
by = "trial"
)
trial_to_tempo <- function(trial_values) {
df <- binned_size_trial %>% select(trial, tempo_pair) %>% distinct()
sapply(trial_values, function(t) df$tempo_pair[df$trial == t])
}
tempo_labeller <- labeller(trial = trial_to_tempo)
p_size_trial <- binned_size_trial %>%
ggplot(aes(x = bin, y = mean_rel, group = 1)) +
geom_line(color = "steelblue", linewidth = 1) +
geom_point(color = "steelblue", size = 2) +
facet_wrap(~trial, ncol = 4, labeller = tempo_labeller) +   # <<< titles changed
theme_bw() +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
labs(
title = "Binned Key–Size per Trial (titles = tempo pairs)",
x = "SizeTime – ColorTime (binned)",
y = "Mean(KeyTime – SizeTime)"
)
p_color_trial <- binned_color_trial %>%
ggplot(aes(x = bin, y = mean_rel, group = 1)) +
geom_line(color = "darkred", linewidth = 1) +
geom_point(color = "darkred", size = 2) +
facet_wrap(~trial, ncol = 4, labeller = tempo_labeller) +   # <<< titles changed
theme_bw() +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
labs(
title = "Binned Key–Color per Trial (titles = tempo pairs)",
x = "SizeTime – ColorTime (binned)",
y = "Mean(KeyTime – ColorTime)"
)
(p_size_trial | p_color_trial)
binned_size_trial
binned_size_trial <- binned_size_trial %>%
left_join(
rel_key_size_vs_sc %>% select(trial, tempo_pair) %>% distinct(),
by = "trial"
)
binned_color_trial <- binned_color_trial %>%
left_join(
rel_key_color_vs_sc %>% select(trial, tempo_pair) %>% distinct(),
by = "trial"
)
binned_size_trial
binned_size_trial <- binned_size_trial %>%
left_join(
rel_key_size_vs_sc %>% select(trial, tempo_pair) %>% distinct(),
by = "trial"
)
binned_color_trial <- binned_color_trial %>%
left_join(
rel_key_color_vs_sc %>% select(trial, tempo_pair) %>% distinct(),
by = "trial"
)
trial_to_tempo <- function(trial_values) {
df <- binned_size_trial %>% select(trial, tempo_pair) %>% distinct()
sapply(trial_values, function(t) df$tempo_pair[df$trial == t])
}
tempo_labeller <- labeller(trial = trial_to_tempo)
p_size_trial <- binned_size_trial %>%
ggplot(aes(x = bin, y = mean_rel, group = 1)) +
geom_line(color = "steelblue", linewidth = 1) +
geom_point(color = "steelblue", size = 2) +
facet_wrap(~trial, ncol = 4, labeller = tempo_labeller) +   # <<< titles changed
theme_bw() +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
labs(
title = "Binned Key–Size per Trial (titles = tempo pairs)",
x = "SizeTime – ColorTime (binned)",
y = "Mean(KeyTime – SizeTime)"
)
p_color_trial <- binned_color_trial %>%
ggplot(aes(x = bin, y = mean_rel, group = 1)) +
geom_line(color = "darkred", linewidth = 1) +
geom_point(color = "darkred", size = 2) +
facet_wrap(~trial, ncol = 4, labeller = tempo_labeller) +   # <<< titles changed
theme_bw() +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
labs(
title = "Binned Key–Color per Trial (titles = tempo pairs)",
x = "SizeTime – ColorTime (binned)",
y = "Mean(KeyTime – ColorTime)"
)
(p_size_trial | p_color_trial)
binned_size_trial %>%
ggplot(aes(x = bin, y = mean_rel, group = 1)) +
geom_line(color = "steelblue", linewidth = 1) +
geom_point(color = "steelblue", size = 2) +
facet_wrap(~trial, ncol = 4, labeller = tempo_labeller) +   # <<< titles changed
theme_bw()
inned_size_trial %>%
ggplot(aes(x = bin, y = mean_rel, group = 1)) +
geom_line(color = "steelblue", linewidth = 1) +
geom_point(color = "steelblue", size = 2) +
facet_wrap(~trial, ncol = 4, labeller = tempo_labeller) +   # <<< titles changed
theme_bw()
binned_size_trial %>%
ggplot(aes(x = bin, y = mean_rel, group = 1)) +
geom_line(color = "steelblue", linewidth = 1) +
geom_point(color = "steelblue", size = 2) +
facet_wrap(~trial, ncol = 4, labeller = tempo_labeller) +   # <<< titles changed
theme_bw()
trial_to_tempo
tempo_labeller
binned_size_trial
library(tidyverse)
library(jsonlite)
# ===========================
# LOAD DATA
# ===========================
setwd("/Users/merve/Library/CloudStorage/OneDrive-YaleUniversity/Projects/Studies/featureDepTempAttnt/experiment/1-pilot/1-1pair/data/filtered")
df <- read.csv("filtered_fdta-tap-1pair_p1.1_irene2.csv",
stringsAsFactors = FALSE, check.names = FALSE)
# ===========================
# --- HELPERS
# ===========================
# extract HSL hue (first number)
extract_hue <- function(hsl_string){
as.numeric(str_extract(hsl_string, "(?<=hsl\\().+?(?=,)"))
}
# parse JSON arrays safely
parse_json <- function(x){
if(is.na(x) | x=="") return(NULL)
# ensure valid JSON
tryCatch({
fromJSON(x)
}, error = function(e) NULL)
}
# ===========================
# PARSE TRIAL-BY-TRIAL
# ===========================
# ===========================
# PARSE TRIAL-BY-TRIAL
# ===========================
parsed <- df %>%
mutate(trial = row_number()) %>%
rowwise() %>%
mutate(
# ---- SIZE CHANGE LOG ----
sizeEvents = list({
raw <- parse_json(sizeChangeLog)
if(is.null(raw)) return(tibble())
tibble(
size_time = raw$timeMs,
size_width = map_dbl(raw$rectSize, 1),
size_height = map_dbl(raw$rectSize, 2)
)
}),
# ---- COLOR CHANGE LOG ----
colorEvents = list({
raw <- parse_json(colorChangeLog)
if(is.null(raw)) return(tibble())
tibble(
color_time = raw$timeMs,
hue = map_dbl(raw$colorHsl, extract_hue)
)
}),
# ---- KEYPRESS LOG ----
keyEvents = list({
raw <- parse_json(keypressLog)
if(is.null(raw)) return(tibble())
tibble(
key_time = raw$time_ms
)
})
) %>%
ungroup()
# ===========================
# UNNEST FIXED (NO DUPLICATE COLUMN NAMES)
# ===========================
size_df <- parsed %>%
select(trial, sizeTempo, colorTempoSet, sizeEvents) %>%
unnest(sizeEvents)
color_df <- parsed %>%
select(trial, sizeTempo, colorTempoSet, colorEvents) %>%
unnest(colorEvents)
key_df <- parsed %>%
select(trial, sizeTempo, colorTempoSet, keyEvents) %>%
unnest(keyEvents)
# ===========================
# UNNEST DATA
# ===========================
size_df   <- parsed %>% select(trial, sizeTempo, colorTempoSet, sizeEvents) %>% unnest(sizeEvents)
color_df  <- parsed %>% select(trial, sizeTempo, colorTempoSet, colorEvents) %>% unnest(colorEvents)
key_df    <- parsed %>% select(trial, sizeTempo, colorTempoSet, keyEvents)  %>% unnest(keyEvents)
# ============================================================
# BIG SIZE TIMES
# ============================================================
size_big <- size_df %>%
group_by(trial) %>%
mutate(
size_val = pmax(size_width, size_height),
big_val = max(unique(size_val)),
is_big = size_val == big_val
) %>%
filter(is_big) %>%
select(trial, size_time)
# ============================================================
# BIG COLOR TIMES
# ============================================================
color_big <- color_df %>%
group_by(trial) %>%
mutate(
big_hue = max(unique(hue)),
is_big = hue == big_hue
) %>%
filter(is_big) %>%
select(trial, color_time)
# ============================================================
# HELPER: pick only FIRST keypress inside ±500 ms window
# ============================================================
pick_key <- function(keys, event_time) {
win <- keys %>% filter(abs(key_time - event_time) <= 500)
if(nrow(win) == 0) return(NA_real_)
win %>% arrange(key_time) %>% slice(1) %>% pull(key_time)
}
# ============================================================
# RELATIVE SIZE (±500 ms window, ONLY FIRST keypress)
# ============================================================
rel_size <- key_df %>%
group_by(trial, sizeTempo, colorTempoSet) %>%
group_modify(~{
keys <- .x
s <- size_big %>% filter(trial == .y$trial)
if(nrow(s) == 0) return(tibble(size_change = numeric(), rel_time = numeric()))
out <- tibble(
size_change = s$size_time,
key_selected = map_dbl(s$size_time, ~ pick_key(keys, .x)),
rel_time = key_selected - size_change
)
out %>% filter(!is.na(rel_time))
}) %>%
ungroup()
# ============================================================
# RELATIVE COLOR (±500 ms window, ONLY FIRST keypress)
# ============================================================
rel_color <- key_df %>%
group_by(trial, sizeTempo, colorTempoSet) %>%
group_modify(~{
keys <- .x
c <- color_big %>% filter(trial == .y$trial)
if(nrow(c) == 0) return(tibble(color_change = numeric(), rel_time = numeric()))
out <- tibble(
color_change = c$color_time,
key_selected = map_dbl(c$color_time, ~ pick_key(keys, .x)),
rel_time = key_selected - color_change
)
out %>% filter(!is.na(rel_time))
}) %>%
ungroup()
# ===========================
# AVERAGE ACROSS TRIALS
# ===========================
summary_df <- tibble(
sizeTempo = rep(rel_size$sizeTempo, 1),
colorTempoSet = rep(rel_size$colorTempoSet, 1),
rel_size = rel_size$rel_time,
rel_color = rel_color$rel_time
) %>%
group_by(sizeTempo, colorTempoSet) %>%
summarize(
mean_rel_size  = mean(rel_size, na.rm=TRUE),
mean_rel_color = mean(rel_color, na.rm=TRUE),
.groups="drop"
)
binned_color_trial <- rel_key_color_vs_sc %>%
mutate(
bin = bin50(size_color_delta)
) %>%
group_by(trial, bin) %>%
summarise(
mean_rel = mean(key_minus_color, na.rm = TRUE),
n = n(),
.groups = "drop"
) %>%
filter(!is.na(bin))
binned_size_trial <- binned_size_trial %>%
left_join(
rel_key_size_vs_sc %>% select(trial, tempo_pair) %>% distinct(),
by = "trial"
)
binned_color_trial <- binned_color_trial %>%
left_join(
rel_key_color_vs_sc %>% select(trial, tempo_pair) %>% distinct(),
by = "trial"
)
trial_to_tempo <- function(trial_values) {
df <- binned_size_trial %>% select(trial, tempo_pair) %>% distinct()
sapply(trial_values, function(t) df$tempo_pair[df$trial == t])
}
tempo_labeller <- labeller(trial = trial_to_tempo)
p_size_trial <- binned_size_trial %>%
ggplot(aes(x = bin, y = mean_rel, group = 1)) +
geom_line(color = "steelblue", linewidth = 1) +
geom_point(color = "steelblue", size = 2) +
facet_wrap(~trial, ncol = 4, labeller = tempo_labeller) +   # <<< titles changed
theme_bw() +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
labs(
title = "Binned Key–Size per Trial (titles = tempo pairs)",
x = "SizeTime – ColorTime (binned)",
y = "Mean(KeyTime – SizeTime)"
)
p_color_trial <- binned_color_trial %>%
ggplot(aes(x = bin, y = mean_rel, group = 1)) +
geom_line(color = "darkred", linewidth = 1) +
geom_point(color = "darkred", size = 2) +
facet_wrap(~trial, ncol = 4, labeller = tempo_labeller) +   # <<< titles changed
theme_bw() +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
labs(
title = "Binned Key–Color per Trial (titles = tempo pairs)",
x = "SizeTime – ColorTime (binned)",
y = "Mean(KeyTime – ColorTime)"
)
(p_size_trial | p_color_trial)
